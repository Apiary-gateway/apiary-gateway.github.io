---
import SidebarScrollLayout from '../layouts/SidebarScrollLayout.astro';
import BaseLayout from '../layouts/BaseLayout.astro';

const headings = [
  {
    id: "introduction",
    title: "Introduction",
    img: "/images/intro.png"
  }
];

// Debug: Log headings
console.log('Headings:', headings);

// Dynamically import all content from content/case-study directory
const sectionComponents = Object.fromEntries(
  await Promise.all(
    headings.map(async ({ id }) => {
      try {
        const module = await import(`../content/case-study/${id}.mdx`);
        console.log(`Loaded MDX for ${id}:`, module.default);
        return [id, module.default];
      } catch (error) {
        console.error(`Error loading MDX for ${id}:`, error);
        return [id, null];
      }
    })
  )
);

// Debug: Log section components
console.log('Section Components:', sectionComponents);

// Helper: Build child image map
function extractChildImages(children = []) {
  return Object.fromEntries(
    children
      .filter((child) => child.img)
      .map((child) => [child.id, child.img])
  );
}
---

<BaseLayout>
  <SidebarScrollLayout headings={headings}>
    <slot>
      {headings.map(({ id, img, children }) => {
        const Component = sectionComponents[id];
        const childImages = extractChildImages(children);
        console.log(`Rendering section ${id}:`, { Component, img, childImages });
        return Component ? (
          <div class="section-content" id={id}>
            <Component img={img} childImages={childImages} />
          </div>
        ) : null;
      })}
    </slot>
  </SidebarScrollLayout>
</BaseLayout>

<style>
  .section-content {
    padding: 2rem;
    max-width: 800px;
    margin: 0 auto;
    background-color: inherit; /* Add background to make content visible */
  }
</style>
